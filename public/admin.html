<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç®¡ç†å“¡å¾Œå°</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 30px;
    }
    h1 {
      margin-top: 0;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .logout-btn {
      background: #ff7675;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }
    th {
      background: #f0f2f5;
    }
  </style>
</head>

<body>

<div class="top-bar">
  <h1>ğŸ›  ç®¡ç†å“¡å¾Œå°</h1>
  <button class="logout-btn" id="logoutBtn">ç™»å‡º</button>
</div>

<div class="card">
  <h3>ğŸ” ç®¡ç†å“¡é©—è­‰ç‹€æ…‹</h3>
  <p id="admin-info">é©—è­‰ä¸­...</p>
</div>

<div class="card">
  <h3>ğŸ‘¥ ä½¿ç”¨è€…åˆ—è¡¨ï¼ˆRBAC ç¤ºç¯„ï¼‰</h3>
  <table>
    <thead>
      <tr>
        <th>Email</th>
        <th>è§’è‰²</th>
      </tr>
    </thead>
    <tbody id="user-table-body">
  <tr>
    <td colspan="2">è¼‰å…¥ä¸­...</td>
  </tr>
</tbody>
  </table>
</div>

<script>
const token = localStorage.getItem('auth_token');

if (!token) {
  alert("è«‹å…ˆç™»å…¥");
  location.href = "index.html";
}

// ç™»å‡º
document.getElementById('logoutBtn').addEventListener('click', () => {
  if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
    localStorage.removeItem('auth_token');
    location.href = "index.html";
  }
});

async function initAdmin() {
  try {
    // 1ï¸âƒ£ ç®¡ç†å“¡èº«åˆ†é©—è­‰
    const res = await fetch('/api/admin/dashboard', {
      headers: { Authorization: 'Bearer ' + token }
    });

    if (!res.ok) throw new Error('NOT_ADMIN');

    const data = await res.json();

    // âœ… ä¿®æ­£ typoï¼ˆé€™è¡Œæ˜¯é—œéµï¼‰
    document.getElementById('admin-info').innerHTML = `
      âœ… å·²é€šéç®¡ç†å“¡é©—è­‰<br>
      ç™»å…¥å¸³è™Ÿï¼š<strong>${data.admin}</strong>
    `;

    // 2ï¸âƒ£ è¼‰å…¥ä½¿ç”¨è€…åˆ—è¡¨
    loadUsers();

  } catch (err) {
    console.error(err);
    alert("æ¬Šé™ä¸è¶³ï¼Œå°‡è¿”å›é¦–é ");
    location.href = "main.html";
  }
}

async function loadUsers() {
  const tbody = document.getElementById('user-table-body');
  tbody.innerHTML = '';

  try {
    const res = await fetch('/api/admin/users', {
      headers: { Authorization: 'Bearer ' + token }
    });

    if (!res.ok) throw new Error();

    const users = await res.json();

    users.forEach(u => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${u.email}</td>
        <td>${u.role}</td>
      `;
      tbody.appendChild(tr);
    });

  } catch {
    tbody.innerHTML = `
      <tr>
        <td colspan="2" style="color:red;">
          ç„¡æ³•è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™
        </td>
      </tr>
    `;
  }
}

initAdmin();
</script>



</body>
</html>
